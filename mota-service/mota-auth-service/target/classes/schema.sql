-- H2 Database Schema for Auth Service (Standalone Mode)
-- Using H2 2.x compatible syntax

CREATE TABLE IF NOT EXISTS sys_user (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    nickname VARCHAR(100),
    email VARCHAR(100),
    phone VARCHAR(20),
    avatar VARCHAR(500),
    status SMALLINT DEFAULT 1,
    deleted SMALLINT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by BIGINT,
    updated_by BIGINT
);

-- Create index for username lookup
CREATE INDEX IF NOT EXISTS idx_sys_user_username ON sys_user(username);

-- Create index for email lookup
CREATE INDEX IF NOT EXISTS idx_sys_user_email ON sys_user(email);

-- Insert default admin user (password: admin123 - BCrypt encoded)
-- BCrypt hash generated for password "admin123"
INSERT INTO sys_user (username, password, nickname, email, status, deleted)
SELECT 'admin', '$2a$10$EIXXPdzA/VGQlnvsLuTiWOKsnErRx2OLGvbLNBJHk0h7/IHvqK3Hy', 'Administrator', 'admin@mota.com', 1, 0
WHERE NOT EXISTS (SELECT 1 FROM sys_user WHERE username = 'admin');