import{r as l,C as K,c as U,f as fe,m as ge,h as he,i as Q,k as be,l as je,a as xe,j as n,S as ye}from"./index-jJjkrASA.js";import{w as Ce,u as ve}from"./api-DUmAbDc_.js";import{F as T}from"./index-CNgAusFm.js";import{T as _e}from"./index-CnGp7M1w.js";import{B as $}from"./button-Bv8EyRxh.js";import{R as Y}from"./PlusOutlined-Bh2Mv01n.js";import{I as B}from"./index-DR1THxsW.js";import{R as Oe}from"./SearchOutlined-OiCr0NYv.js";import{T as Se,R as Ie}from"./index-CCdK-d4Q.js";import{C as Ne}from"./index-CiIGZjGq.js";import{M as Z}from"./index--XrJVTfB.js";import{R as ee}from"./FileTextOutlined-Ts-3bQU2.js";import{R as Ee,E as te}from"./DownOutlined-CN1mv8sD.js";import{S as re}from"./index-DEZvTLAg.js";import{p as oe,t as ne,I as Pe}from"./compact-item-CfP0ZfjF.js";import{b as Re,D as we}from"./index-BUg6PNCH.js";import{R as $e}from"./EditOutlined-H6Ny8KCv.js";import{R as ke}from"./MoreOutlined-CjOKr4kg.js";import{R as He}from"./DeleteOutlined-KwwWlgLe.js";import{s as W}from"./index-C54hh6U9.js";import"./getAllowClear-DijkFjz0.js";import"./CloseCircleFilled-DzUWwAnM.js";import"./useForm-PTvZdMqb.js";import"./row-DbvWXo5m.js";import"./index-F9YRoaSd.js";import"./CheckCircleFilled-C1tkfSYQ.js";import"./ExclamationCircleFilled-CjD5Kf6C.js";import"./styleChecker-apvlJGDR.js";import"./TextArea-D2UEp3z5.js";import"./CheckOutlined-CH83bvZX.js";import"./RightOutlined-CFLGXWAw.js";import"./Input-BYqifNCC.js";import"./index-DDCwCr0k.js";import"./Skeleton-CpdpnCda.js";import"./index-KYPfHnUh.js";import"./CloseOutlined-JFFLTca6.js";import"./EllipsisOutlined-Bct-hJoY.js";import"./ActionButton-BlIwnF7n.js";import"./fade-5De2vm1n.js";import"./useClosable-Dcdur4ya.js";import"./extendsObject-78o_rR5W.js";import"./PurePanel-BjAOE1jZ.js";import"./LeftOutlined-DSxe2Naa.js";import"./move-DCQK6w6D.js";const D=({children:e})=>{const{getPrefixCls:a}=l.useContext(K),r=a("breadcrumb");return l.createElement("li",{className:`${r}-separator`,"aria-hidden":"true"},e===""?e:e||"/")};D.__ANT_BREADCRUMB_SEPARATOR=!0;var Te=function(e,a){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(e);s<t.length;s++)a.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(r[t[s]]=e[t[s]]);return r};function Me(e,a){if(e.title===void 0||e.title===null)return null;const r=Object.keys(a).join("|");return typeof e.title=="object"?e.title:String(e.title).replace(new RegExp(`:(${r})`,"g"),(t,s)=>a[s]||t)}function ie(e,a,r,t){if(r==null)return null;const{className:s,onClick:m}=a,i=Te(a,["className","onClick"]),d=Object.assign(Object.assign({},oe(i,{data:!0,aria:!0})),{onClick:m});return t!==void 0?l.createElement("a",Object.assign({},d,{className:U(`${e}-link`,s),href:t}),r):l.createElement("span",Object.assign({},d,{className:U(`${e}-link`,s)}),r)}function Be(e,a){return(t,s,m,i,d)=>{if(a)return a(t,s,m,i);const g=Me(t,s);return ie(e,t,g,d)}}var q=function(e,a){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(e);s<t.length;s++)a.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(r[t[s]]=e[t[s]]);return r};const le=e=>{const{prefixCls:a,separator:r="/",children:t,menu:s,overlay:m,dropdownProps:i,href:d}=e,O=(S=>{if(s||m){const h=Object.assign({},i);if(s){const _=s||{},{items:x}=_,b=q(_,["items"]);h.menu=Object.assign(Object.assign({},b),{items:x?.map((j,f)=>{var{key:I,title:k,label:N,path:y}=j,H=q(j,["key","title","label","path"]);let E=N??k;return y&&(E=l.createElement("a",{href:`${d}${y}`},E)),Object.assign(Object.assign({},H),{key:I??f,label:E})})})}else m&&(h.overlay=m);return l.createElement(Re,Object.assign({placement:"bottom"},h),l.createElement("span",{className:`${a}-overlay-link`},S,l.createElement(Ee,null)))}return S})(t);return O!=null?l.createElement(l.Fragment,null,l.createElement("li",{className:`${a}-item`},O),r&&l.createElement(D,null,r)):null},ce=e=>{const{prefixCls:a,children:r,href:t}=e,s=q(e,["prefixCls","children","href"]),{getPrefixCls:m}=l.useContext(K),i=m("breadcrumb",a);return l.createElement(le,Object.assign({},s,{prefixCls:i}),ie(i,s,r,t))};ce.__ANT_BREADCRUMB_ITEM=!0;const De=e=>{const{componentCls:a,iconCls:r,calc:t}=e;return{[a]:Object.assign(Object.assign({},he(e)),{color:e.itemColor,fontSize:e.fontSize,[r]:{fontSize:e.iconFontSize},ol:{display:"flex",flexWrap:"wrap",margin:0,padding:0,listStyle:"none"},[`${a}-item a`]:Object.assign({color:e.linkColor,transition:`color ${e.motionDurationMid}`,padding:`0 ${Q(e.paddingXXS)}`,borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",marginInline:t(e.marginXXS).mul(-1).equal(),"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover}},be(e)),[`${a}-item:last-child`]:{color:e.lastItemColor},[`${a}-separator`]:{marginInline:e.separatorMargin,color:e.separatorColor},[`${a}-link`]:{[`
          > ${r} + span,
          > ${r} + a
        `]:{marginInlineStart:e.marginXXS}},[`${a}-overlay-link`]:{borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",padding:`0 ${Q(e.paddingXXS)}`,marginInline:t(e.marginXXS).mul(-1).equal(),[`> ${r}`]:{marginInlineStart:e.marginXXS,fontSize:e.fontSizeIcon},"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover,a:{color:e.linkHoverColor}},a:{"&:hover":{backgroundColor:"transparent"}}},[`&${e.componentCls}-rtl`]:{direction:"rtl"}})}},ze=e=>({itemColor:e.colorTextDescription,lastItemColor:e.colorText,iconFontSize:e.fontSize,linkColor:e.colorTextDescription,linkHoverColor:e.colorText,separatorColor:e.colorTextDescription,separatorMargin:e.marginXS}),Ae=fe("Breadcrumb",e=>{const a=ge(e,{});return De(a)},ze);var ae=function(e,a){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(e);s<t.length;s++)a.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(r[t[s]]=e[t[s]]);return r};function Le(e){const{breadcrumbName:a,children:r}=e,t=ae(e,["breadcrumbName","children"]),s=Object.assign({title:a},t);return r&&(s.menu={items:r.map(m=>{var{breadcrumbName:i}=m,d=ae(m,["breadcrumbName"]);return Object.assign(Object.assign({},d),{title:i})})}),s}function Xe(e,a){return l.useMemo(()=>e||(a?a.map(Le):null),[e,a])}var Fe=function(e,a){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(e);s<t.length;s++)a.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(r[t[s]]=e[t[s]]);return r};const Ve=(e,a)=>{if(a===void 0)return a;let r=(a||"").replace(/^\//,"");return Object.keys(e).forEach(t=>{r=r.replace(`:${t}`,e[t])}),r},G=e=>{const{prefixCls:a,separator:r="/",style:t,className:s,rootClassName:m,routes:i,items:d,children:g,itemRender:O,params:S={}}=e,h=Fe(e,["prefixCls","separator","style","className","rootClassName","routes","items","children","itemRender","params"]),{getPrefixCls:_,direction:x,breadcrumb:b}=l.useContext(K);let j;const f=_("breadcrumb",a),[I,k,N]=Ae(f),y=Xe(d,i),H=Be(f,O);if(y&&y.length>0){const C=[],P=d||i;j=y.map((v,w)=>{const{path:A,key:o,type:c,menu:p,overlay:R,onClick:L,className:de,separator:me,dropdownProps:ue}=v,X=Ve(S,A);X!==void 0&&C.push(X);const J=o??w;if(c==="separator")return l.createElement(D,{key:J},me);const F={},pe=w===y.length-1;p?F.menu=p:R&&(F.overlay=R);let{href:V}=v;return C.length&&X!==void 0&&(V=`#/${C.join("/")}`),l.createElement(le,Object.assign({key:J},F,oe(v,{data:!0,aria:!0}),{className:de,dropdownProps:ue,href:V,separator:pe?"":r,onClick:L,prefixCls:f}),H(v,S,P,C,V))})}else if(g){const C=ne(g).length;j=ne(g).map((P,v)=>{if(!P)return P;const w=v===C-1;return je(P,{separator:w?"":r,key:v})})}const E=U(f,b?.className,{[`${f}-rtl`]:x==="rtl"},s,m,k,N),z=Object.assign(Object.assign({},b?.style),t);return I(l.createElement("nav",Object.assign({className:E,style:z},h),l.createElement("ol",null,j)))};G.Item=ce;G.Separator=D;var We={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"}}]},name:"home",theme:"outlined"},Ue=function(a,r){return l.createElement(Pe,xe({},a,{ref:r,icon:We}))},qe=l.forwardRef(Ue);const Ke="_container_gekim_1",Ge="_sidebar_gekim_13",Je="_sidebarHeader_gekim_31",Qe="_searchInput_gekim_47",Ye="_treeContainer_gekim_55",Ze="_content_gekim_67",et="_contentCard_gekim_79",tt="_loading_gekim_87",rt="_pageContent_gekim_101",nt="_pageHeader_gekim_109",at="_pageMeta_gekim_127",st="_pageBody_gekim_135",ot="_editor_gekim_189",it="_editorHeader_gekim_201",lt="_titleInput_gekim_215",ct="_contentEditor_gekim_227",u={container:Ke,sidebar:Ge,sidebarHeader:Je,searchInput:Qe,treeContainer:Ye,content:Ze,contentCard:et,loading:tt,pageContent:rt,pageHeader:nt,pageMeta:at,pageBody:st,editor:ot,editorHeader:it,titleInput:lt,contentEditor:ct},{Title:M,Paragraph:dt,Text:mt}=_e,{TextArea:se}=B,rr=()=>{const[e,a]=l.useState(!0),[r,t]=l.useState([]),[s,m]=l.useState([]),[i,d]=l.useState(null),[g,O]=l.useState(""),[S,h]=l.useState(!1),[_,x]=l.useState(""),[b,j]=l.useState(!1),[f]=T.useForm();l.useEffect(()=>{I()},[]);const I=async()=>{a(!0);try{const[o,c]=await Promise.all([Ce.getWikiPages(),ve.getUsers()]);t(o.data),m(c.data),o.data.length>0&&d(o.data[0])}catch(o){console.error("Failed to load wiki pages:",o)}finally{a(!1)}},k=()=>{const o=r.filter(p=>p.parentId===null),c=p=>{const R=r.filter(L=>L.parentId===p.id);return{key:String(p.id),title:p.title,icon:R.length>0?n.jsx(Ie,{}):n.jsx(ee,{}),children:R.length>0?R.map(c):void 0,isLeaf:R.length===0,data:p}};return o.map(c)},N=()=>g?r.filter(c=>c.title.toLowerCase().includes(g.toLowerCase())||c.content.toLowerCase().includes(g.toLowerCase())).map(c=>({key:String(c.id),title:c.title,icon:n.jsx(ee,{}),isLeaf:!0,data:c})):k(),y=o=>{if(o.length>0){const c=r.find(p=>p.id===Number(o[0]));c&&(d(c),h(!1))}},H=()=>{i&&(x(i.content),h(!0))},E=()=>{i&&(d({...i,content:_}),t(r.map(o=>o.id===i.id?{...o,content:_}:o)),h(!1),W.success("保存成功"))},z=()=>{h(!1),x("")},C=()=>{j(!0)},P=async()=>{try{const o=await f.validateFields(),c={id:r.length+1,title:o.title,parentId:o.parentId||null,content:o.content||"# "+o.title+`

开始编写内容...`,author:1,updatedAt:new Date().toISOString().split("T")[0]};t([...r,c]),d(c),j(!1),f.resetFields(),W.success("页面创建成功")}catch(o){console.error("Validation failed:",o)}},v=()=>{i&&Z.confirm({title:"确认删除",content:`确定要删除页面"${i.title}"吗？`,onOk:()=>{t(r.filter(o=>o.id!==i.id)),d(r.find(o=>o.id!==i.id)||null),W.success("删除成功")}})},w=o=>s.find(p=>p.id===o)?.name||"未知用户",A=()=>i?S?n.jsxs("div",{className:u.editor,children:[n.jsxs("div",{className:u.editorHeader,children:[n.jsx(B,{value:i.title,onChange:o=>d({...i,title:o.target.value}),className:u.titleInput}),n.jsxs(re,{children:[n.jsx($,{onClick:z,children:"取消"}),n.jsx($,{type:"primary",onClick:E,children:"保存"})]})]}),n.jsx(se,{value:_,onChange:o=>x(o.target.value),className:u.contentEditor,placeholder:"使用 Markdown 格式编写内容...",autoSize:{minRows:20}})]}):n.jsxs("div",{className:u.pageContent,children:[n.jsxs("div",{className:u.pageHeader,children:[n.jsx(G,{items:[{title:n.jsxs(n.Fragment,{children:[n.jsx(qe,{})," 知识库"]})},{title:i.title}]}),n.jsxs(re,{children:[n.jsx($,{icon:n.jsx($e,{}),onClick:H,children:"编辑"}),n.jsx(we,{menu:{items:[{key:"delete",label:"删除",icon:n.jsx(He,{}),danger:!0,onClick:v}]},children:n.jsx($,{icon:n.jsx(ke,{})})})]})]}),n.jsx(M,{level:2,children:i.title}),n.jsx("div",{className:u.pageMeta,children:n.jsxs(mt,{type:"secondary",children:["作者: ",w(i.author)," · 更新于 ",i.updatedAt]})}),n.jsx("div",{className:u.pageBody,children:i.content.split(`
`).map((o,c)=>o.startsWith("# ")?n.jsx(M,{level:1,children:o.slice(2)},c):o.startsWith("## ")?n.jsx(M,{level:2,children:o.slice(3)},c):o.startsWith("### ")?n.jsx(M,{level:3,children:o.slice(4)},c):o.trim()?n.jsx(dt,{children:o},c):n.jsx("br",{},c))})]}):n.jsx(te,{description:"请选择一个页面或创建新页面",image:te.PRESENTED_IMAGE_SIMPLE,children:n.jsx($,{type:"primary",icon:n.jsx(Y,{}),onClick:C,children:"创建页面"})});return e?n.jsx("div",{className:u.loading,children:n.jsx(ye,{size:"large"})}):n.jsxs("div",{className:u.container,children:[n.jsxs("div",{className:u.sidebar,children:[n.jsxs("div",{className:u.sidebarHeader,children:[n.jsx(M,{level:4,style:{margin:0},children:"知识库"}),n.jsx($,{type:"primary",icon:n.jsx(Y,{}),size:"small",onClick:C,children:"新建"})]}),n.jsx(B,{placeholder:"搜索页面...",prefix:n.jsx(Oe,{}),value:g,onChange:o=>O(o.target.value),className:u.searchInput,allowClear:!0}),n.jsx("div",{className:u.treeContainer,children:n.jsx(Se,{showIcon:!0,defaultExpandAll:!0,selectedKeys:i?[String(i.id)]:[],onSelect:y,treeData:N()})})]}),n.jsx("div",{className:u.content,children:n.jsx(Ne,{className:u.contentCard,children:A()})}),n.jsx(Z,{title:"创建新页面",open:b,onOk:P,onCancel:()=>{j(!1),f.resetFields()},children:n.jsxs(T,{form:f,layout:"vertical",children:[n.jsx(T.Item,{name:"title",label:"页面标题",rules:[{required:!0,message:"请输入页面标题"}],children:n.jsx(B,{placeholder:"请输入页面标题"})}),n.jsx(T.Item,{name:"parentId",label:"父级页面",children:n.jsx(B,{placeholder:"可选，留空则为顶级页面"})}),n.jsx(T.Item,{name:"content",label:"初始内容",children:n.jsx(se,{rows:4,placeholder:"可选，页面初始内容"})})]})})]})};export{rr as default};
