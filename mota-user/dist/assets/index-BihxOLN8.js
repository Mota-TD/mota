import{b as V,r,j as t}from"./index-jJjkrASA.js";import{p as B,i as f}from"./api-DUmAbDc_.js";import{F as l}from"./index-CNgAusFm.js";import{B as n}from"./button-Bv8EyRxh.js";import{R as J}from"./PlusOutlined-Bh2Mv01n.js";import{I as j,R as L}from"./index-DR1THxsW.js";import{R as O}from"./SearchOutlined-OiCr0NYv.js";import{S as i}from"./index-DDqd5aTF.js";import{T as Q}from"./getAllowClear-DijkFjz0.js";import{R as G}from"./FilterOutlined-CHcJfTDx.js";import{F as H}from"./Table-D_d-WrwC.js";import{M as k}from"./index--XrJVTfB.js";import{S as U}from"./index-DEZvTLAg.js";import{A as W}from"./index-CzYeSCDM.js";import{D as X}from"./index-BUg6PNCH.js";import{R as Y}from"./MoreOutlined-CjOKr4kg.js";import{R as Z}from"./EditOutlined-H6Ny8KCv.js";import{R as ee}from"./DeleteOutlined-KwwWlgLe.js";import{T as g}from"./index-C-XfQ0lz.js";import{s as x}from"./index-C54hh6U9.js";import"./compact-item-CfP0ZfjF.js";import"./useForm-PTvZdMqb.js";import"./row-DbvWXo5m.js";import"./index-F9YRoaSd.js";import"./CheckCircleFilled-C1tkfSYQ.js";import"./CloseCircleFilled-DzUWwAnM.js";import"./ExclamationCircleFilled-CjD5Kf6C.js";import"./RightOutlined-CFLGXWAw.js";import"./Input-BYqifNCC.js";import"./TextArea-D2UEp3z5.js";import"./EllipsisOutlined-Bct-hJoY.js";import"./DownOutlined-CN1mv8sD.js";import"./PurePanel-BjAOE1jZ.js";import"./move-DCQK6w6D.js";import"./CheckOutlined-CH83bvZX.js";import"./CloseOutlined-JFFLTca6.js";import"./styleChecker-apvlJGDR.js";import"./index-CCdK-d4Q.js";import"./index-DDCwCr0k.js";import"./index-x8kxzmt0.js";import"./useBubbleLock-DgSu3aet.js";import"./index-BRkQ33iO.js";import"./Pagination-4QOE6sQE.js";import"./LeftOutlined-DSxe2Naa.js";import"./extendsObject-78o_rR5W.js";import"./ActionButton-BlIwnF7n.js";import"./Skeleton-CpdpnCda.js";import"./fade-5De2vm1n.js";import"./useClosable-Dcdur4ya.js";import"./index-D31JVHEt.js";const te="_issues_1mqe9_1",se="_header_1mqe9_9",oe="_toolbar_1mqe9_35",re="_filters_1mqe9_43",ae="_issueKey_1mqe9_55",le="_formActions_1mqe9_77",c={issues:te,header:se,toolbar:oe,filters:re,issueKey:ae,formActions:le},ot=()=>{const y=V(),[S,v]=r.useState(!0),[C,_]=r.useState([]),[T,R]=r.useState(0),[b,A]=r.useState([]),[w,F]=r.useState(""),[s,d]=r.useState({projectId:void 0,type:void 0,status:void 0,priority:void 0}),[p,I]=r.useState({current:1,pageSize:20}),[M,u]=r.useState(!1),[m]=l.useForm();r.useEffect(()=>{$()},[]),r.useEffect(()=>{h()},[p,s]);const $=async()=>{try{const e=await B.getProjects();A(e.data.list||e.data)}catch(e){console.error("Failed to load projects:",e)}},h=async()=>{v(!0);try{const e=await f.getIssues({projectId:s.projectId,status:s.status,type:s.type,search:w||void 0});_(e.data.list||[]),R(e.data.total||0)}catch(e){console.error("Failed to load issues:",e)}finally{v(!1)}},q=()=>{I({...p,current:1}),h()},N=async e=>{try{await f.createIssue(e),x.success("事项创建成功"),u(!1),m.resetFields(),h()}catch(o){x.error(o.message||"创建失败")}},P=e=>{k.confirm({title:"确认删除",content:"删除后不可恢复，确定要删除这个事项吗？",okText:"确认删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{await f.deleteIssue(e),x.success("事项已删除"),h()}catch{x.error("删除失败")}}})},z=e=>{const a={story:{color:"green",text:"需求"},task:{color:"blue",text:"任务"},bug:{color:"red",text:"缺陷"},epic:{color:"purple",text:"史诗"}}[e]||{color:"default",text:e};return t.jsx(g,{color:a.color,children:a.text})},E=e=>{const a={open:{color:"default",text:"待处理"},in_progress:{color:"processing",text:"进行中"},done:{color:"success",text:"已完成"},closed:{color:"default",text:"已关闭"}}[e]||{color:"default",text:e};return t.jsx(g,{color:a.color,children:a.text})},K=e=>{const a={highest:{color:"#ff4d4f",text:"最高"},high:{color:"#fa8c16",text:"高"},medium:{color:"#1677ff",text:"中"},low:{color:"#52c41a",text:"低"},lowest:{color:"#8c8c8c",text:"最低"}}[e]||{color:"#8c8c8c",text:e};return t.jsx(g,{color:a.color,children:a.text})},D=[{title:"标识",dataIndex:"key",key:"key",width:100,render:e=>t.jsx("span",{className:c.issueKey,children:e})},{title:"标题",dataIndex:"title",key:"title",ellipsis:!0,render:(e,o)=>t.jsx("a",{onClick:()=>y(`/issues/${o.id}`),children:e})},{title:"类型",dataIndex:"type",key:"type",width:80,render:e=>z(e)},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>E(e)},{title:"优先级",dataIndex:"priority",key:"priority",width:80,render:e=>K(e)},{title:"经办人",dataIndex:"assigneeName",key:"assignee",width:120,render:e=>e?t.jsxs(U,{children:[t.jsx(W,{size:"small",children:e.charAt(0)}),t.jsx("span",{children:e})]}):"-"},{title:"故事点",dataIndex:"storyPoints",key:"storyPoints",width:80,align:"center"},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",width:120},{title:"操作",key:"action",width:80,fixed:"right",render:(e,o)=>t.jsx(X,{menu:{items:[{key:"view",icon:t.jsx(L,{}),label:"查看详情",onClick:()=>y(`/issues/${o.id}`)},{key:"edit",icon:t.jsx(Z,{}),label:"编辑",onClick:()=>y(`/issues/${o.id}`)},{type:"divider"},{key:"delete",icon:t.jsx(ee,{}),label:"删除",danger:!0,onClick:()=>P(o.id)}]},trigger:["click"],children:t.jsx(n,{type:"text",icon:t.jsx(Y,{})})})}];return t.jsxs("div",{className:c.issues,children:[t.jsxs("div",{className:c.header,children:[t.jsx("h2",{children:"事项列表"}),t.jsx(n,{type:"primary",icon:t.jsx(J,{}),onClick:()=>u(!0),children:"创建事项"})]}),t.jsx("div",{className:c.toolbar,children:t.jsxs("div",{className:c.filters,children:[t.jsx(j,{placeholder:"搜索事项",prefix:t.jsx(O,{}),value:w,onChange:e=>F(e.target.value),onPressEnter:q,style:{width:200},allowClear:!0}),t.jsx(i,{placeholder:"项目",value:s.projectId,onChange:e=>d({...s,projectId:e}),style:{width:150},allowClear:!0,options:b.map(e=>({value:e.id,label:e.name}))}),t.jsx(i,{placeholder:"类型",value:s.type,onChange:e=>d({...s,type:e}),style:{width:100},allowClear:!0,options:[{value:"story",label:"需求"},{value:"task",label:"任务"},{value:"bug",label:"缺陷"},{value:"epic",label:"史诗"}]}),t.jsx(i,{placeholder:"状态",value:s.status,onChange:e=>d({...s,status:e}),style:{width:100},allowClear:!0,options:[{value:"open",label:"待处理"},{value:"in_progress",label:"进行中"},{value:"done",label:"已完成"},{value:"closed",label:"已关闭"}]}),t.jsx(i,{placeholder:"优先级",value:s.priority,onChange:e=>d({...s,priority:e}),style:{width:100},allowClear:!0,options:[{value:"highest",label:"最高"},{value:"high",label:"高"},{value:"medium",label:"中"},{value:"low",label:"低"},{value:"lowest",label:"最低"}]}),t.jsx(Q,{title:"更多筛选",children:t.jsx(n,{icon:t.jsx(G,{})})})]})}),t.jsx(H,{columns:D,dataSource:C,rowKey:"id",loading:S,pagination:{current:p.current,pageSize:p.pageSize,total:T,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:e=>{I({current:e.current||1,pageSize:e.pageSize||20})},scroll:{x:1200}}),t.jsx(k,{title:"创建事项",open:M,onCancel:()=>{u(!1),m.resetFields()},footer:null,width:600,children:t.jsxs(l,{form:m,layout:"vertical",onFinish:N,children:[t.jsx(l.Item,{name:"projectId",label:"所属项目",rules:[{required:!0,message:"请选择项目"}],children:t.jsx(i,{placeholder:"请选择项目",options:b.map(e=>({value:e.id,label:e.name}))})}),t.jsx(l.Item,{name:"type",label:"事项类型",rules:[{required:!0,message:"请选择类型"}],children:t.jsx(i,{placeholder:"请选择类型",options:[{value:"story",label:"需求"},{value:"task",label:"任务"},{value:"bug",label:"缺陷"}]})}),t.jsx(l.Item,{name:"title",label:"标题",rules:[{required:!0,message:"请输入标题"}],children:t.jsx(j,{placeholder:"请输入事项标题"})}),t.jsx(l.Item,{name:"description",label:"描述",children:t.jsx(j.TextArea,{rows:4,placeholder:"请输入事项描述"})}),t.jsx(l.Item,{name:"priority",label:"优先级",initialValue:"medium",children:t.jsx(i,{options:[{value:"highest",label:"最高"},{value:"high",label:"高"},{value:"medium",label:"中"},{value:"low",label:"低"},{value:"lowest",label:"最低"}]})}),t.jsx(l.Item,{children:t.jsxs("div",{className:c.formActions,children:[t.jsx(n,{onClick:()=>{u(!1),m.resetFields()},children:"取消"}),t.jsx(n,{type:"primary",htmlType:"submit",children:"创建"})]})})]})})]})};export{ot as default};
