import{M as O,b as H,r as u,j as t,S as K}from"./index-jJjkrASA.js";import{d as R}from"./dayjs.min-B5Y1J0u4.js";import{s as U,p as q,i as G,c as J}from"./api-DUmAbDc_.js";import{s as d}from"./index-C54hh6U9.js";import{B as i}from"./button-Bv8EyRxh.js";import{R as Q}from"./ArrowLeftOutlined-DrQGsIYE.js";import{T as j}from"./index-C-XfQ0lz.js";import{S as y}from"./index-DEZvTLAg.js";import{R as k}from"./PlayCircleOutlined-BYlYA78z.js";import{R as v}from"./CheckCircleOutlined-CPk3538Q.js";import{R as W}from"./EditOutlined-H6Ny8KCv.js";import{D as X}from"./index-BUg6PNCH.js";import{R as Y}from"./MoreOutlined-CjOKr4kg.js";import{R as Z}from"./DeleteOutlined-KwwWlgLe.js";import{C as x}from"./index-CiIGZjGq.js";import{R as b,C as c}from"./row-DbvWXo5m.js";import{R as tt}from"./CalendarOutlined-Cxn5QWrl.js";import{S as p}from"./index-XJKxwp2H.js";import{P as et}from"./progress-BfLFEfyG.js";import{F as st}from"./Table-D_d-WrwC.js";import{R as rt}from"./PlusOutlined-Bh2Mv01n.js";import{M as N}from"./index--XrJVTfB.js";import{A as ot}from"./index-CzYeSCDM.js";import{R as S}from"./ClockCircleOutlined-CiuAMI-C.js";import{R as at}from"./BugOutlined-CKjc4xeY.js";import"./compact-item-CfP0ZfjF.js";import"./CheckCircleFilled-C1tkfSYQ.js";import"./CloseCircleFilled-DzUWwAnM.js";import"./ExclamationCircleFilled-CjD5Kf6C.js";import"./getAllowClear-DijkFjz0.js";import"./CloseOutlined-JFFLTca6.js";import"./RightOutlined-CFLGXWAw.js";import"./useClosable-Dcdur4ya.js";import"./extendsObject-78o_rR5W.js";import"./LeftOutlined-DSxe2Naa.js";import"./EllipsisOutlined-Bct-hJoY.js";import"./PurePanel-BjAOE1jZ.js";import"./move-DCQK6w6D.js";import"./Skeleton-CpdpnCda.js";import"./index-KYPfHnUh.js";import"./index-F9YRoaSd.js";import"./CheckOutlined-CH83bvZX.js";import"./styleChecker-apvlJGDR.js";import"./DownOutlined-CN1mv8sD.js";import"./index-CCdK-d4Q.js";import"./index-DDCwCr0k.js";import"./index-x8kxzmt0.js";import"./useBubbleLock-DgSu3aet.js";import"./index-BRkQ33iO.js";import"./useForm-PTvZdMqb.js";import"./index-DDqd5aTF.js";import"./SearchOutlined-OiCr0NYv.js";import"./Pagination-4QOE6sQE.js";import"./Input-BYqifNCC.js";import"./ActionButton-BlIwnF7n.js";import"./fade-5De2vm1n.js";import"./index-D31JVHEt.js";const nt="_container_1vbgj_1",it="_header_1vbgj_13",ct="_headerLeft_1vbgj_33",lt="_sprintInfo_1vbgj_45",dt="_sprintTitle_1vbgj_57",pt="_sprintName_1vbgj_69",mt="_projectTag_1vbgj_81",xt="_infoCard_1vbgj_89",ut="_dateInfo_1vbgj_99",jt="_dateLabel_1vbgj_121",ft="_dateValue_1vbgj_131",ht="_goal_1vbgj_141",gt="_progressBar_1vbgj_157",yt="_statsRow_1vbgj_165",vt="_statCard_1vbgj_173",_t="_issuesCard_1vbgj_183",r={container:nt,header:it,headerLeft:ct,sprintInfo:lt,sprintTitle:dt,sprintName:pt,projectTag:mt,infoCard:xt,dateInfo:ut,dateLabel:jt,dateValue:ft,goal:ht,progressBar:gt,statsRow:yt,statCard:vt,issuesCard:_t},ke=()=>{const{id:f}=O(),l=H(),[w,_]=u.useState(!0),[o,h]=u.useState(null),[g,P]=u.useState(null),[n,T]=u.useState([]);u.useEffect(()=>{f&&$(parseInt(f))},[f]);const $=async e=>{_(!0);try{const s=await U.getSprintById(e);if(h(s.data),s.data.projectId){const[a,F]=await Promise.all([q.getProjectById(s.data.projectId),G.getIssues({sprintId:e})]);P(a.data),T(F.data.list||[])}}catch(s){console.error("Failed to load sprint:",s),d.error("加载迭代失败")}finally{_(!1)}},D=async()=>{if(o)try{d.success("迭代已开始"),h({...o,status:"active"})}catch{d.error("操作失败")}},L=async()=>{o&&N.confirm({title:"完成迭代",content:"确定要完成这个迭代吗？未完成的事项将移回需求池。",okText:"确认完成",cancelText:"取消",onOk:async()=>{try{d.success("迭代已完成"),h({...o,status:"completed"})}catch{d.error("操作失败")}}})},B=()=>{N.confirm({title:"确认删除",content:"删除迭代后，相关事项将移回需求池，此操作不可恢复。",okText:"确认删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{d.success("迭代已删除"),l("/iterations")}catch{d.error("删除失败")}}})},A=e=>{const a={planning:{color:"default",text:"规划中",icon:t.jsx(S,{})},active:{color:"processing",text:"进行中",icon:t.jsx(k,{})},completed:{color:"success",text:"已完成",icon:t.jsx(v,{})}}[e]||{color:"default",text:e,icon:null};return t.jsx(j,{color:a.color,icon:a.icon,children:a.text})},M=e=>{switch(e){case"bug":return t.jsx(at,{style:{color:"#ff4d4f"}});case"story":return t.jsx(v,{style:{color:"#52c41a"}});default:return t.jsx(S,{style:{color:"#1677ff"}})}},z=e=>{const s={open:{color:"default",text:"待处理"},in_progress:{color:"processing",text:"进行中"},testing:{color:"warning",text:"测试中"},review:{color:"cyan",text:"待评审"},done:{color:"success",text:"已完成"}};return t.jsx(j,{color:s[e]?.color,children:s[e]?.text})},V=e=>{const s={highest:{color:"red",text:"最高"},high:{color:"orange",text:"高"},medium:{color:"blue",text:"中"},low:{color:"green",text:"低"},lowest:{color:"default",text:"最低"}};return t.jsx(j,{color:s[e]?.color,children:s[e]?.text})},I=()=>{if(!o)return 0;const e=R(o.endDate),s=R(),a=e.diff(s,"day");return a>0?a:0},C=()=>!o||o.totalPoints===0?0:Math.round(o.completedPoints/o.totalPoints*100),m={totalIssues:n.length,openIssues:n.filter(e=>e.status==="open").length,inProgressIssues:n.filter(e=>e.status==="in_progress").length,doneIssues:n.filter(e=>e.status==="done").length,totalPoints:n.reduce((e,s)=>e+(s.storyPoints||0),0),completedPoints:n.filter(e=>e.status==="done").reduce((e,s)=>e+(s.storyPoints||0),0)},E=[{title:"类型",dataIndex:"type",key:"type",width:60,render:e=>M(e)},{title:"标识",dataIndex:"key",key:"key",width:100,render:(e,s)=>t.jsx("a",{onClick:()=>l(`/issues/${s.id}`),children:e})},{title:"标题",dataIndex:"title",key:"title",ellipsis:!0},{title:"优先级",dataIndex:"priority",key:"priority",width:80,render:e=>V(e)},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>z(e)},{title:"故事点",dataIndex:"storyPoints",key:"storyPoints",width:80,align:"center"},{title:"负责人",dataIndex:"assignee",key:"assignee",width:100,render:e=>{if(!e)return"-";const s=J.find(a=>a.id===e);return s?t.jsxs(y,{children:[t.jsx(ot,{size:"small",src:s.avatar,children:s.name.charAt(0)}),s.name]}):"-"}}];return w?t.jsx("div",{className:r.container,style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:t.jsx(K,{size:"large"})}):o?t.jsxs("div",{className:r.container,children:[t.jsxs("div",{className:r.header,children:[t.jsxs("div",{className:r.headerLeft,children:[t.jsx(i,{type:"text",icon:t.jsx(Q,{}),onClick:()=>l("/iterations")}),t.jsxs("div",{className:r.sprintInfo,children:[t.jsxs("div",{className:r.sprintTitle,children:[t.jsx("h1",{className:r.sprintName,children:o.name}),A(o.status)]}),g&&t.jsx(j,{className:r.projectTag,onClick:()=>l(`/projects/${g.id}`),style:{cursor:"pointer"},children:g.name})]})]}),t.jsxs(y,{children:[o.status==="planning"&&t.jsx(i,{type:"primary",icon:t.jsx(k,{}),onClick:D,children:"开始迭代"}),o.status==="active"&&t.jsx(i,{type:"primary",icon:t.jsx(v,{}),onClick:L,children:"完成迭代"}),t.jsx(i,{icon:t.jsx(W,{}),children:"编辑"}),t.jsx(X,{menu:{items:[{key:"delete",icon:t.jsx(Z,{}),label:"删除迭代",danger:!0,onClick:B}]},children:t.jsx(i,{icon:t.jsx(Y,{})})})]})]}),t.jsxs(x,{className:r.infoCard,children:[t.jsxs(b,{gutter:24,children:[t.jsx(c,{span:6,children:t.jsxs("div",{className:r.dateInfo,children:[t.jsx(tt,{}),t.jsxs("div",{children:[t.jsx("div",{className:r.dateLabel,children:"迭代周期"}),t.jsxs("div",{className:r.dateValue,children:[o.startDate," ~ ",o.endDate]})]})]})}),t.jsx(c,{span:6,children:t.jsx(p,{title:"剩余天数",value:I(),suffix:"天",valueStyle:{color:I()<3?"#ff4d4f":"#1677ff"}})}),t.jsx(c,{span:6,children:t.jsx(p,{title:"故事点进度",value:m.completedPoints,suffix:`/ ${m.totalPoints}`})}),t.jsx(c,{span:6,children:t.jsx(p,{title:"完成率",value:C(),suffix:"%",valueStyle:{color:"#52c41a"}})})]}),o.goal&&t.jsxs("div",{className:r.goal,children:[t.jsx("strong",{children:"迭代目标："}),o.goal]}),t.jsx("div",{className:r.progressBar,children:t.jsx(et,{percent:C(),strokeColor:"#1677ff"})})]}),t.jsxs(b,{gutter:16,className:r.statsRow,children:[t.jsx(c,{span:6,children:t.jsx(x,{className:r.statCard,children:t.jsx(p,{title:"总事项",value:m.totalIssues})})}),t.jsx(c,{span:6,children:t.jsx(x,{className:r.statCard,children:t.jsx(p,{title:"待处理",value:m.openIssues,valueStyle:{color:"#faad14"}})})}),t.jsx(c,{span:6,children:t.jsx(x,{className:r.statCard,children:t.jsx(p,{title:"进行中",value:m.inProgressIssues,valueStyle:{color:"#1677ff"}})})}),t.jsx(c,{span:6,children:t.jsx(x,{className:r.statCard,children:t.jsx(p,{title:"已完成",value:m.doneIssues,valueStyle:{color:"#52c41a"}})})})]}),t.jsx(x,{title:"迭代事项",className:r.issuesCard,extra:t.jsxs(y,{children:[t.jsx(i,{type:"primary",icon:t.jsx(rt,{}),onClick:()=>l("/backlog"),children:"添加事项"}),t.jsx(i,{onClick:()=>l("/kanban"),children:"看板视图"})]}),children:t.jsx(st,{columns:E,dataSource:n,rowKey:"id",pagination:{total:n.length,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}})})]}):t.jsx("div",{className:r.container,children:t.jsxs("div",{style:{textAlign:"center",padding:"48px"},children:[t.jsx("h2",{children:"迭代不存在"}),t.jsx(i,{type:"primary",onClick:()=>l("/iterations"),children:"返回迭代列表"})]})})};export{ke as default};
