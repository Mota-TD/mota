import{b as G,r as o,j as e,S as L}from"./index-jJjkrASA.js";import{d as v}from"./dayjs.min-B5Y1J0u4.js";import{p as q,s as R}from"./api-DUmAbDc_.js";import{F as i}from"./index-CNgAusFm.js";import{B as l}from"./button-Bv8EyRxh.js";import{R as V}from"./PlusOutlined-Bh2Mv01n.js";import{S as I}from"./index-DDqd5aTF.js";import{E as N}from"./DownOutlined-CN1mv8sD.js";import{R as b,C as j}from"./row-DbvWXo5m.js";import{C as O}from"./index-CiIGZjGq.js";import{D as J}from"./index-BUg6PNCH.js";import{R as K}from"./MoreOutlined-CjOKr4kg.js";import{R as C}from"./CalendarOutlined-Cxn5QWrl.js";import{P as Q}from"./progress-BfLFEfyG.js";import{S as P}from"./index-XJKxwp2H.js";import{M as k}from"./index--XrJVTfB.js";import{I as D}from"./index-DR1THxsW.js";import{D as U}from"./index-dos1w039.js";import{T as W}from"./index-C-XfQ0lz.js";import{R as X}from"./EditOutlined-H6Ny8KCv.js";import{R as Z}from"./DeleteOutlined-KwwWlgLe.js";import{s as p}from"./index-C54hh6U9.js";import{R as ee}from"./CheckCircleOutlined-CPk3538Q.js";import{R as te}from"./PlayCircleOutlined-BYlYA78z.js";import{R as se}from"./ClockCircleOutlined-CiuAMI-C.js";import"./getAllowClear-DijkFjz0.js";import"./compact-item-CfP0ZfjF.js";import"./CloseCircleFilled-DzUWwAnM.js";import"./useForm-PTvZdMqb.js";import"./CheckCircleFilled-C1tkfSYQ.js";import"./ExclamationCircleFilled-CjD5Kf6C.js";import"./RightOutlined-CFLGXWAw.js";import"./EllipsisOutlined-Bct-hJoY.js";import"./PurePanel-BjAOE1jZ.js";import"./move-DCQK6w6D.js";import"./CheckOutlined-CH83bvZX.js";import"./CloseOutlined-JFFLTca6.js";import"./SearchOutlined-OiCr0NYv.js";import"./index-F9YRoaSd.js";import"./Skeleton-CpdpnCda.js";import"./index-KYPfHnUh.js";import"./LeftOutlined-DSxe2Naa.js";import"./index-DEZvTLAg.js";import"./ActionButton-BlIwnF7n.js";import"./fade-5De2vm1n.js";import"./useClosable-Dcdur4ya.js";import"./extendsObject-78o_rR5W.js";import"./Input-BYqifNCC.js";import"./TextArea-D2UEp3z5.js";const re="_iterations_6gp1e_1",oe="_header_6gp1e_9",ae="_toolbar_6gp1e_35",ie="_filters_6gp1e_49",ne="_loading_6gp1e_61",ce="_sprintCard_6gp1e_75",le="_cardHeader_6gp1e_95",de="_sprintInfo_6gp1e_109",me="_sprintName_6gp1e_121",pe="_cardBody_6gp1e_135",fe="_sprintGoal_6gp1e_143",ge="_dateRange_6gp1e_165",xe="_progressSection_6gp1e_183",je="_progressHeader_6gp1e_191",he="_cardFooter_6gp1e_209",ue="_formActions_6gp1e_237",r={iterations:re,header:oe,toolbar:ae,filters:ie,loading:ne,sprintCard:ce,cardHeader:le,sprintInfo:de,sprintName:me,cardBody:pe,sprintGoal:fe,dateRange:ge,progressSection:xe,progressHeader:je,cardFooter:he,formActions:ue},gt=()=>{const h=G(),[F,f]=o.useState(!0),[g,x]=o.useState([]),[M,w]=o.useState([]),[n,u]=o.useState(),[d,E]=o.useState("all"),[A,c]=o.useState(!1),[m]=i.useForm();o.useEffect(()=>{T()},[]),o.useEffect(()=>{_()},[n,d]);const T=async()=>{try{const t=await q.getProjects(),s=t.data.list||t.data;w(s),s.length>0&&u(s[0].id)}catch(t){console.error("Failed to load projects:",t)}},_=async()=>{if(!n){x([]),f(!1);return}f(!0);try{const t={projectId:n};d!=="all"&&(t.status=d);const s=await R.getSprints(t),a=Array.isArray(s.data)?s.data:s.data.list||[];x(a)}catch(t){console.error("Failed to load sprints:",t)}finally{f(!1)}},$=async t=>{try{await R.createSprint({...t,projectId:n,startDate:t.dateRange[0].format("YYYY-MM-DD"),endDate:t.dateRange[1].format("YYYY-MM-DD")}),p.success("迭代创建成功"),c(!1),m.resetFields(),_()}catch(s){p.error(s.message||"创建失败")}},H=t=>{k.confirm({title:"确认删除",content:"删除迭代后，相关数据将被清除，此操作不可恢复。",okText:"确认删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{x(g.filter(s=>s.id!==t)),p.success("迭代已删除")}catch{p.error("删除失败")}}})},Y=t=>{const a={planning:{color:"default",text:"规划中",icon:e.jsx(se,{})},active:{color:"processing",text:"进行中",icon:e.jsx(te,{})},completed:{color:"success",text:"已完成",icon:e.jsx(ee,{})}}[t]||{color:"default",text:t,icon:null};return e.jsx(W,{color:a.color,icon:a.icon,children:a.text})},B=t=>[{key:"view",icon:e.jsx(C,{}),label:"查看详情",onClick:()=>h(`/iterations/${t.id}`)},{key:"edit",icon:e.jsx(X,{}),label:"编辑迭代"},{type:"divider"},{key:"delete",icon:e.jsx(Z,{}),label:"删除迭代",danger:!0,onClick:()=>H(t.id)}],z=t=>{const s=v(t),a=v(),S=s.diff(a,"day");return S>0?S:0},y=t=>t.totalPoints===0?0:Math.round(t.completedPoints/t.totalPoints*100);return e.jsxs("div",{className:r.iterations,children:[e.jsxs("div",{className:r.header,children:[e.jsx("h2",{children:"迭代管理"}),e.jsx(l,{type:"primary",icon:e.jsx(V,{}),onClick:()=>c(!0),children:"创建迭代"})]}),e.jsx("div",{className:r.toolbar,children:e.jsxs("div",{className:r.filters,children:[e.jsx(I,{placeholder:"选择项目",value:n,onChange:u,style:{width:200},options:M.map(t=>({value:t.id,label:t.name}))}),e.jsx(I,{value:d,onChange:E,style:{width:120},options:[{value:"all",label:"全部状态"},{value:"planning",label:"规划中"},{value:"active",label:"进行中"},{value:"completed",label:"已完成"}]})]})}),F?e.jsx("div",{className:r.loading,children:e.jsx(L,{size:"large"})}):g.length===0?e.jsx(N,{description:"暂无迭代",image:N.PRESENTED_IMAGE_SIMPLE,children:e.jsx(l,{type:"primary",onClick:()=>c(!0),children:"创建第一个迭代"})}):e.jsx(b,{gutter:[16,16],children:g.map(t=>e.jsx(j,{xs:24,sm:12,lg:8,children:e.jsxs(O,{className:r.sprintCard,hoverable:!0,onClick:()=>h(`/iterations/${t.id}`),children:[e.jsxs("div",{className:r.cardHeader,children:[e.jsxs("div",{className:r.sprintInfo,children:[e.jsx("h3",{className:r.sprintName,children:t.name}),Y(t.status)]}),e.jsx(J,{menu:{items:B(t)},trigger:["click"],placement:"bottomRight",children:e.jsx(l,{type:"text",size:"small",icon:e.jsx(K,{}),onClick:s=>s.stopPropagation()})})]}),e.jsxs("div",{className:r.cardBody,children:[e.jsx("p",{className:r.sprintGoal,children:t.goal||"暂无迭代目标"}),e.jsxs("div",{className:r.dateRange,children:[e.jsx(C,{}),e.jsxs("span",{children:[t.startDate," ~ ",t.endDate]})]}),e.jsxs("div",{className:r.progressSection,children:[e.jsxs("div",{className:r.progressHeader,children:[e.jsx("span",{children:"完成进度"}),e.jsxs("span",{children:[t.completedPoints," / ",t.totalPoints," 故事点"]})]}),e.jsx(Q,{percent:y(t),strokeColor:"#1677ff",size:"small"})]})]}),e.jsx("div",{className:r.cardFooter,children:e.jsxs(b,{gutter:16,children:[e.jsx(j,{span:12,children:e.jsx(P,{title:"剩余天数",value:z(t.endDate),suffix:"天",valueStyle:{fontSize:16}})}),e.jsx(j,{span:12,children:e.jsx(P,{title:"完成率",value:y(t),suffix:"%",valueStyle:{fontSize:16,color:"#52c41a"}})})]})})]})},t.id))}),e.jsx(k,{title:"创建迭代",open:A,onCancel:()=>{c(!1),m.resetFields()},footer:null,width:520,children:e.jsxs(i,{form:m,layout:"vertical",onFinish:$,children:[e.jsx(i.Item,{name:"name",label:"迭代名称",rules:[{required:!0,message:"请输入迭代名称"}],children:e.jsx(D,{placeholder:"如：Sprint 1"})}),e.jsx(i.Item,{name:"dateRange",label:"迭代周期",rules:[{required:!0,message:"请选择迭代周期"}],children:e.jsx(U.RangePicker,{style:{width:"100%"}})}),e.jsx(i.Item,{name:"goal",label:"迭代目标",children:e.jsx(D.TextArea,{rows:3,placeholder:"请输入迭代目标"})}),e.jsx(i.Item,{children:e.jsxs("div",{className:r.formActions,children:[e.jsx(l,{onClick:()=>{c(!1),m.resetFields()},children:"取消"}),e.jsx(l,{type:"primary",htmlType:"submit",children:"创建"})]})})]})})]})};export{gt as default};
