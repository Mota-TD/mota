import{r,a as U,b as W,j as s,S as X}from"./index-jJjkrASA.js";import{p as Y,i as k,s as Z}from"./api-DUmAbDc_.js";import{B as m}from"./button-Bv8EyRxh.js";import{R as ss}from"./PlusOutlined-Bh2Mv01n.js";import{S as _}from"./index-DDqd5aTF.js";import{I as es}from"./index-DR1THxsW.js";import{R as ts}from"./SearchOutlined-OiCr0NYv.js";import{E as x}from"./DownOutlined-CN1mv8sD.js";import{C as w}from"./index-x8kxzmt0.js";import{I as is}from"./compact-item-CfP0ZfjF.js";import{T as g}from"./index-C-XfQ0lz.js";import{T as rs}from"./getAllowClear-DijkFjz0.js";import{A as M}from"./index-CzYeSCDM.js";import{R as as}from"./UserOutlined-eSGHSk0-.js";import{D as os}from"./index-BUg6PNCH.js";import{R as cs}from"./MoreOutlined-CjOKr4kg.js";import{R as ls}from"./CalendarOutlined-Cxn5QWrl.js";import{C as ns}from"./index-CiIGZjGq.js";import{M as ds}from"./index--XrJVTfB.js";import{s as A}from"./index-C54hh6U9.js";import"./RightOutlined-CFLGXWAw.js";import"./EllipsisOutlined-Bct-hJoY.js";import"./PurePanel-BjAOE1jZ.js";import"./move-DCQK6w6D.js";import"./CheckOutlined-CH83bvZX.js";import"./CloseCircleFilled-DzUWwAnM.js";import"./CloseOutlined-JFFLTca6.js";import"./Input-BYqifNCC.js";import"./TextArea-D2UEp3z5.js";import"./useBubbleLock-DgSu3aet.js";import"./index-DDCwCr0k.js";import"./useClosable-Dcdur4ya.js";import"./extendsObject-78o_rR5W.js";import"./index-D31JVHEt.js";import"./LeftOutlined-DSxe2Naa.js";import"./index-DEZvTLAg.js";import"./Skeleton-CpdpnCda.js";import"./index-KYPfHnUh.js";import"./CheckCircleFilled-C1tkfSYQ.js";import"./ExclamationCircleFilled-CjD5Kf6C.js";import"./ActionButton-BlIwnF7n.js";import"./index-F9YRoaSd.js";import"./fade-5De2vm1n.js";var ps={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 00-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 00-11.3 0L405.6 242.3a7.23 7.23 0 005.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 000 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 00.1-11.4z"}}]},name:"drag",theme:"outlined"},ms=function(j,p){return r.createElement(is,U({},j,{ref:p,icon:ps}))},hs=r.forwardRef(ms);const us="_backlog_17r2c_1",_s="_header_17r2c_15",xs="_headerActions_17r2c_39",gs="_toolbar_17r2c_49",js="_filters_17r2c_65",fs="_stats_17r2c_79",ys="_statItem_17r2c_93",vs="_batchActions_17r2c_101",Ns="_loading_17r2c_121",Ps="_issueList_17r2c_135",Is="_listHeader_17r2c_149",As="_colTitle_17r2c_179",bs="_colType_17r2c_189",Cs="_colPriority_17r2c_199",Ss="_colPoints_17r2c_209",Ts="_colAssignee_17r2c_219",ks="_colActions_17r2c_229",ws="_issueItem_17r2c_239",Ms="_selected_17r2c_271",Ls="_issueTitle_17r2c_279",Rs="_dragHandle_17r2c_297",Es="_issueKey_17r2c_315",Hs="_issueType_17r2c_349",$s="_issuePriority_17r2c_351",Ds="_issuePoints_17r2c_353",zs="_issueAssignee_17r2c_355",Fs="_issueActions_17r2c_357",Vs="_sprintPanel_17r2c_411",Bs="_sprintList_17r2c_439",Ks="_sprintCard_17r2c_451",Os="_sprintHeader_17r2c_469",Gs="_sprintName_17r2c_483",qs="_sprintMeta_17r2c_491",Js="_sprintProgress_17r2c_503",Qs="_planModal_17r2c_513",t={backlog:us,header:_s,headerActions:xs,toolbar:gs,filters:js,stats:fs,statItem:ys,batchActions:vs,loading:Ns,issueList:Ps,listHeader:Is,colTitle:As,colType:bs,colPriority:Cs,colPoints:Ss,colAssignee:Ts,colActions:ks,issueItem:ws,selected:Ms,issueTitle:Ls,dragHandle:Rs,issueKey:Es,issueType:Hs,issuePriority:$s,issuePoints:Ds,issueAssignee:zs,issueActions:Fs,sprintPanel:Vs,sprintList:Bs,sprintCard:Ks,sprintHeader:Os,sprintName:Gs,sprintMeta:qs,sprintProgress:Js,planModal:Qs},De=()=>{const n=W(),[j,p]=r.useState(!0),[L,b]=r.useState([]),[f,C]=r.useState([]),[R,E]=r.useState([]),[d,S]=r.useState(),[a,l]=r.useState([]),[h,H]=r.useState(""),[y,$]=r.useState(),[v,D]=r.useState(),[z,u]=r.useState(!1),[N,P]=r.useState();r.useEffect(()=>{F()},[]),r.useEffect(()=>{d&&T()},[d]);const F=async()=>{try{const e=await Y.getProjects(),i=e.data.list||e.data;E(i),i.length>0&&S(i[0].id)}catch(e){console.error("Failed to load projects:",e)}},T=async()=>{if(!d){b([]),C([]),p(!1);return}p(!0);try{const o=((await k.getIssues({projectId:d})).data.list||[]).filter(Q=>!Q.sprintId);b(o);const I=await Z.getSprints({projectId:d}),J=Array.isArray(I.data)?I.data:I.data.list||[];C(J)}catch(e){console.error("Failed to load data:",e)}finally{p(!1)}},V=(e,i)=>{l(i?[...a,e]:a.filter(o=>o!==e))},B=e=>{l(e?c.map(i=>i.id):[])},K=async()=>{if(!N||a.length===0){A.warning("请选择迭代和事项");return}try{for(const e of a)await k.updateIssue(e,{sprintId:N});A.success(`已将 ${a.length} 个事项规划到迭代`),u(!1),l([]),P(void 0),T()}catch{A.error("规划失败")}},O=e=>{const o={story:{color:"green",text:"需求"},task:{color:"blue",text:"任务"},bug:{color:"red",text:"缺陷"},epic:{color:"purple",text:"史诗"}}[e]||{color:"default",text:e};return s.jsx(g,{color:o.color,children:o.text})},G=e=>{const o={highest:{color:"#ff4d4f",text:"最高"},high:{color:"#fa8c16",text:"高"},medium:{color:"#1677ff",text:"中"},low:{color:"#52c41a",text:"低"},lowest:{color:"#8c8c8c",text:"最低"}}[e]||{color:"#8c8c8c",text:e};return s.jsx(g,{color:o.color,children:o.text})},c=L.filter(e=>{let i=!0;return h&&(i=i&&(e.title.toLowerCase().includes(h.toLowerCase())||e.key.toLowerCase().includes(h.toLowerCase()))),y&&(i=i&&e.type===y),v&&(i=i&&e.priority===v),i}),q=c.reduce((e,i)=>e+(i.storyPoints||0),0);return s.jsxs("div",{className:t.backlog,children:[s.jsxs("div",{className:t.header,children:[s.jsx("h2",{children:"需求池"}),s.jsx("div",{className:t.headerActions,children:s.jsx(m,{type:"primary",icon:s.jsx(ss,{}),onClick:()=>n("/issues"),children:"创建事项"})})]}),s.jsxs("div",{className:t.toolbar,children:[s.jsxs("div",{className:t.filters,children:[s.jsx(_,{placeholder:"选择项目",value:d,onChange:S,style:{width:180},options:R.map(e=>({value:e.id,label:e.name}))}),s.jsx(es,{placeholder:"搜索事项",prefix:s.jsx(ts,{}),value:h,onChange:e=>H(e.target.value),style:{width:200},allowClear:!0}),s.jsx(_,{placeholder:"类型",value:y,onChange:$,style:{width:100},allowClear:!0,options:[{value:"story",label:"需求"},{value:"task",label:"任务"},{value:"bug",label:"缺陷"}]}),s.jsx(_,{placeholder:"优先级",value:v,onChange:D,style:{width:100},allowClear:!0,options:[{value:"highest",label:"最高"},{value:"high",label:"高"},{value:"medium",label:"中"},{value:"low",label:"低"},{value:"lowest",label:"最低"}]})]}),s.jsxs("div",{className:t.stats,children:[s.jsxs("span",{className:t.statItem,children:["共 ",s.jsx("strong",{children:c.length})," 个事项"]}),s.jsxs("span",{className:t.statItem,children:["总计 ",s.jsx("strong",{children:q})," 故事点"]})]})]}),a.length>0&&s.jsxs("div",{className:t.batchActions,children:[s.jsxs("span",{children:["已选择 ",a.length," 项"]}),s.jsx(m,{type:"primary",size:"small",onClick:()=>u(!0),children:"规划到迭代"}),s.jsx(m,{size:"small",onClick:()=>l([]),children:"取消选择"})]}),j?s.jsx("div",{className:t.loading,children:s.jsx(X,{size:"large"})}):c.length===0?s.jsx(x,{description:"需求池为空",image:x.PRESENTED_IMAGE_SIMPLE,children:s.jsx(m,{type:"primary",onClick:()=>n("/issues"),children:"创建事项"})}):s.jsxs("div",{className:t.issueList,children:[s.jsxs("div",{className:t.listHeader,children:[s.jsx(w,{checked:a.length===c.length&&c.length>0,indeterminate:a.length>0&&a.length<c.length,onChange:e=>B(e.target.checked)}),s.jsx("span",{className:t.colTitle,children:"标题"}),s.jsx("span",{className:t.colType,children:"类型"}),s.jsx("span",{className:t.colPriority,children:"优先级"}),s.jsx("span",{className:t.colPoints,children:"故事点"}),s.jsx("span",{className:t.colAssignee,children:"负责人"}),s.jsx("span",{className:t.colActions,children:"操作"})]}),c.map(e=>s.jsxs("div",{className:`${t.issueItem} ${a.includes(e.id)?t.selected:""}`,children:[s.jsx(w,{checked:a.includes(e.id),onChange:i=>V(e.id,i.target.checked)}),s.jsxs("div",{className:t.issueTitle,children:[s.jsx(hs,{className:t.dragHandle}),s.jsx("span",{className:t.issueKey,children:e.key}),s.jsx("a",{onClick:()=>n(`/issues/${e.id}`),children:e.title})]}),s.jsx("div",{className:t.issueType,children:O(e.type)}),s.jsx("div",{className:t.issuePriority,children:G(e.priority)}),s.jsx("div",{className:t.issuePoints,children:s.jsx(g,{children:e.storyPoints||"-"})}),s.jsx("div",{className:t.issueAssignee,children:e.assigneeName?s.jsx(rs,{title:e.assigneeName,children:s.jsx(M,{size:"small",children:e.assigneeName.charAt(0)})}):s.jsx(M,{size:"small",icon:s.jsx(as,{})})}),s.jsx("div",{className:t.issueActions,children:s.jsx(os,{menu:{items:[{key:"plan",icon:s.jsx(ls,{}),label:"规划到迭代",onClick:()=>{l([e.id]),u(!0)}},{key:"view",label:"查看详情",onClick:()=>n(`/issues/${e.id}`)}]},trigger:["click"],children:s.jsx(m,{type:"text",size:"small",icon:s.jsx(cs,{})})})})]},e.id))]}),s.jsxs("div",{className:t.sprintPanel,children:[s.jsx("h3",{children:"迭代列表"}),f.length===0?s.jsx(x,{description:"暂无迭代",image:x.PRESENTED_IMAGE_SIMPLE}):s.jsx("div",{className:t.sprintList,children:f.map(e=>s.jsxs(ns,{size:"small",className:t.sprintCard,onClick:()=>n(`/iterations/${e.id}`),children:[s.jsxs("div",{className:t.sprintHeader,children:[s.jsx("span",{className:t.sprintName,children:e.name}),s.jsx(g,{color:e.status==="active"?"processing":"default",children:e.status==="active"?"进行中":e.status==="completed"?"已完成":"规划中"})]}),s.jsx("div",{className:t.sprintMeta,children:s.jsxs("span",{children:[e.startDate," ~ ",e.endDate]})}),s.jsx("div",{className:t.sprintProgress,children:s.jsxs("span",{children:[e.completedPoints," / ",e.totalPoints," 故事点"]})})]},e.id))})]}),s.jsx(ds,{title:"规划到迭代",open:z,onCancel:()=>{u(!1),P(void 0)},onOk:K,okText:"确认规划",cancelText:"取消",children:s.jsxs("div",{className:t.planModal,children:[s.jsxs("p",{children:["将 ",a.length," 个事项规划到："]}),s.jsx(_,{placeholder:"选择迭代",value:N,onChange:P,style:{width:"100%"},options:f.filter(e=>e.status!=="completed").map(e=>({value:e.id,label:e.name}))})]})})]})};export{De as default};
