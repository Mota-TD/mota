import{M as H,b as M,r as l,j as e,S as K}from"./index-jJjkrASA.js";import{p as V,i as B,s as G,b as E,c as h}from"./api-DUmAbDc_.js";import{s as b}from"./index-C54hh6U9.js";import{B as r}from"./button-Bv8EyRxh.js";import{R as F}from"./ArrowLeftOutlined-DrQGsIYE.js";import{R as U}from"./UserOutlined-eSGHSk0-.js";import{R as q}from"./CalendarOutlined-Cxn5QWrl.js";import{S as _}from"./index-DEZvTLAg.js";import{R as J,a as O}from"./StarOutlined-BMYNSswx.js";import{R as Q}from"./SettingOutlined-CawUlI4j.js";import{D as W}from"./index-BUg6PNCH.js";import{R as X}from"./MoreOutlined-CjOKr4kg.js";import{T as Y}from"./index-KYPfHnUh.js";import{P as u}from"./progress-BfLFEfyG.js";import{R as v}from"./PlusOutlined-Bh2Mv01n.js";import{A as f}from"./index-CzYeSCDM.js";import{F as Z}from"./Table-D_d-WrwC.js";import{T as m}from"./index-C-XfQ0lz.js";import{R as ee}from"./ClockCircleOutlined-CiuAMI-C.js";import{R as se}from"./CheckCircleOutlined-CPk3538Q.js";import{R as te}from"./BugOutlined-CKjc4xeY.js";import"./compact-item-CfP0ZfjF.js";import"./CheckCircleFilled-C1tkfSYQ.js";import"./CloseCircleFilled-DzUWwAnM.js";import"./ExclamationCircleFilled-CjD5Kf6C.js";import"./getAllowClear-DijkFjz0.js";import"./CloseOutlined-JFFLTca6.js";import"./RightOutlined-CFLGXWAw.js";import"./LeftOutlined-DSxe2Naa.js";import"./EllipsisOutlined-Bct-hJoY.js";import"./PurePanel-BjAOE1jZ.js";import"./move-DCQK6w6D.js";import"./CheckOutlined-CH83bvZX.js";import"./index-D31JVHEt.js";import"./styleChecker-apvlJGDR.js";import"./DownOutlined-CN1mv8sD.js";import"./index-CCdK-d4Q.js";import"./index-DDCwCr0k.js";import"./index-x8kxzmt0.js";import"./useBubbleLock-DgSu3aet.js";import"./index-BRkQ33iO.js";import"./useForm-PTvZdMqb.js";import"./index-DDqd5aTF.js";import"./SearchOutlined-OiCr0NYv.js";import"./Pagination-4QOE6sQE.js";import"./extendsObject-78o_rR5W.js";import"./Input-BYqifNCC.js";import"./useClosable-Dcdur4ya.js";const ae="_container_1idez_1",re="_header_1idez_13",ie="_headerLeft_1idez_35",ce="_projectAvatar_1idez_45",oe="_projectInfo_1idez_69",ne="_projectTitle_1idez_77",le="_projectName_1idez_91",de="_projectKey_1idez_105",me="_projectDesc_1idez_121",pe="_projectMeta_1idez_133",xe="_tabs_1idez_149",je="_statsRow_1idez_161",he="_statCard_1idez_175",_e="_statValue_1idez_189",ue="_statLabel_1idez_201",ve="_contentGrid_1idez_239",fe="_mainContent_1idez_251",ye="_sideContent_1idez_263",Ne="_card_1idez_275",ge="_cardHeader_1idez_289",Ie="_cardTitle_1idez_303",ze="_issueItem_1idez_317",be="_issueKey_1idez_341",Ce="_issueTitle_1idez_353",ke="_memberItem_1idez_365",Te="_memberInfo_1idez_379",Re="_memberName_1idez_387",we="_memberRole_1idez_399",Se="_activityItem_1idez_409",Pe="_activityContent_1idez_431",Ae="_activityText_1idez_439",De="_activityTime_1idez_449",Le="_progressSection_1idez_461",$e="_progressLabel_1idez_469",He="_sprintCard_1idez_485",Me="_sprintHeader_1idez_507",Ke="_sprintName_1idez_521",Ve="_sprintDates_1idez_533",t={container:ae,header:re,headerLeft:ie,projectAvatar:ce,projectInfo:oe,projectTitle:ne,projectName:le,projectKey:de,projectDesc:me,projectMeta:pe,tabs:xe,statsRow:je,statCard:he,statValue:_e,statLabel:ue,contentGrid:ve,mainContent:fe,sideContent:ye,card:Ne,cardHeader:ge,cardTitle:Ie,issueItem:ze,issueKey:be,issueTitle:Ce,memberItem:ke,memberInfo:Te,memberName:Re,memberRole:we,activityItem:Se,activityContent:Pe,activityText:Ae,activityTime:De,progressSection:Le,progressLabel:$e,sprintCard:He,sprintHeader:Me,sprintName:Ke,sprintDates:Ve},Ls=()=>{const{id:p}=H(),i=M(),[C,y]=l.useState(!0),[c,k]=l.useState(null),[o,T]=l.useState([]),[x,R]=l.useState([]),[j,N]=l.useState(!1);l.useEffect(()=>{p&&w(parseInt(p))},[p]);const w=async s=>{y(!0);try{const[a,n,$]=await Promise.all([V.getProjectById(s),B.getIssues({projectId:s}),G.getSprints({projectId:s})]);k(a.data),N(a.data.starred),T(n.data.list||[]),R($.data||[])}catch(a){console.error("Failed to load project:",a),b.error("加载项目失败")}finally{y(!1)}},S=()=>{N(!j),b.success(j?"已取消收藏":"已收藏")},P=s=>{const n={active:{color:"green",text:"进行中"},completed:{color:"blue",text:"已完成"},archived:{color:"default",text:"已归档"}}[s]||{color:"default",text:s};return e.jsx(m,{color:n.color,children:n.text})},g=s=>{switch(s){case"bug":return e.jsx(te,{style:{color:"#ff4d4f"}});case"story":return e.jsx(se,{style:{color:"#52c41a"}});default:return e.jsx(ee,{style:{color:"#1677ff"}})}},I=s=>{const a={high:{color:"red",text:"高"},medium:{color:"orange",text:"中"},low:{color:"green",text:"低"}};return e.jsx(m,{color:a[s]?.color,children:a[s]?.text})},z=s=>{const a={active:{color:"processing",text:"进行中"},planning:{color:"default",text:"规划中"},completed:{color:"success",text:"已完成"}};return e.jsx(m,{color:a[s]?.color,children:a[s]?.text})},d={totalIssues:o.length,openIssues:o.filter(s=>s.status==="open").length,inProgressIssues:o.filter(s=>s.status==="in_progress").length,doneIssues:o.filter(s=>s.status==="done").length},A=[{title:"类型",dataIndex:"type",key:"type",width:60,render:s=>g(s)},{title:"标识",dataIndex:"key",key:"key",width:100,render:s=>e.jsx("a",{onClick:()=>i(`/issues/${s}`),children:s})},{title:"标题",dataIndex:"title",key:"title",ellipsis:!0},{title:"优先级",dataIndex:"priority",key:"priority",width:80,render:s=>I(s)},{title:"状态",dataIndex:"status",key:"status",width:100,render:s=>{const a={open:{color:"default",text:"待处理"},in_progress:{color:"processing",text:"进行中"},testing:{color:"warning",text:"测试中"},done:{color:"success",text:"已完成"}};return e.jsx(m,{color:a[s]?.color,children:a[s]?.text})}},{title:"负责人",dataIndex:"assignee",key:"assignee",width:100,render:s=>{if(!s)return"-";const a=h.find(n=>n.id===s);return a?e.jsxs(_,{children:[e.jsx(f,{size:"small",src:a.avatar,children:a.name.charAt(0)}),a.name]}):"-"}}],D=h.slice(0,5),L=E.slice(0,5).map(s=>({...s,user:h.find(a=>a.id===s.userId)}));return C?e.jsx("div",{className:t.container,style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(K,{size:"large"})}):c?e.jsxs("div",{className:t.container,children:[e.jsxs("div",{className:t.header,children:[e.jsxs("div",{className:t.headerLeft,children:[e.jsx(r,{type:"text",icon:e.jsx(F,{}),onClick:()=>i("/projects"),style:{marginRight:8}}),e.jsx("div",{className:t.projectAvatar,style:{backgroundColor:c.color},children:c.name.charAt(0)}),e.jsxs("div",{className:t.projectInfo,children:[e.jsxs("div",{className:t.projectTitle,children:[e.jsx("h1",{className:t.projectName,children:c.name}),e.jsx("span",{className:t.projectKey,children:c.key}),P(c.status)]}),e.jsx("p",{className:t.projectDesc,children:c.description||"暂无描述"}),e.jsxs("div",{className:t.projectMeta,children:[e.jsxs("span",{children:[e.jsx(U,{})," ",c.memberCount," 成员"]}),e.jsxs("span",{children:[e.jsx(q,{})," 创建于 ",c.createdAt]})]})]})]}),e.jsxs(_,{children:[e.jsx(r,{type:"text",icon:j?e.jsx(J,{style:{color:"#faad14"}}):e.jsx(O,{}),onClick:S}),e.jsx(r,{icon:e.jsx(Q,{}),onClick:()=>i("/settings"),children:"设置"}),e.jsx(W,{menu:{items:[{key:"archive",label:"归档项目"},{type:"divider"},{key:"delete",label:"删除项目",danger:!0}]},children:e.jsx(r,{icon:e.jsx(X,{})})})]})]}),e.jsxs("div",{className:t.statsRow,children:[e.jsxs("div",{className:t.statCard,children:[e.jsx("div",{className:t.statValue,children:d.totalIssues}),e.jsx("div",{className:t.statLabel,children:"总事项"})]}),e.jsxs("div",{className:t.statCard,children:[e.jsx("div",{className:t.statValue,style:{color:"#faad14"},children:d.openIssues}),e.jsx("div",{className:t.statLabel,children:"待处理"})]}),e.jsxs("div",{className:t.statCard,children:[e.jsx("div",{className:t.statValue,style:{color:"#1677ff"},children:d.inProgressIssues}),e.jsx("div",{className:t.statLabel,children:"进行中"})]}),e.jsxs("div",{className:t.statCard,children:[e.jsx("div",{className:t.statValue,style:{color:"#52c41a"},children:d.doneIssues}),e.jsx("div",{className:t.statLabel,children:"已完成"})]})]}),e.jsx(Y,{defaultActiveKey:"overview",className:t.tabs,items:[{key:"overview",label:"概览",children:e.jsxs("div",{className:t.contentGrid,children:[e.jsxs("div",{className:t.mainContent,children:[e.jsxs("div",{className:t.card,children:[e.jsx("div",{className:t.cardHeader,children:e.jsx("h3",{className:t.cardTitle,children:"项目进度"})}),e.jsxs("div",{className:t.progressSection,children:[e.jsxs("div",{className:t.progressLabel,children:[e.jsx("span",{children:"整体进度"}),e.jsxs("span",{children:[c.progress,"%"]})]}),e.jsx(u,{percent:c.progress,showInfo:!1,strokeColor:"#1677ff"})]})]}),e.jsxs("div",{className:t.card,children:[e.jsxs("div",{className:t.cardHeader,children:[e.jsx("h3",{className:t.cardTitle,children:"当前迭代"}),e.jsx(r,{type:"link",size:"small",onClick:()=>i("/iterations"),children:"查看全部"})]}),x.filter(s=>s.status==="active").map(s=>e.jsxs("div",{className:t.sprintCard,children:[e.jsxs("div",{className:t.sprintHeader,children:[e.jsx("span",{className:t.sprintName,children:s.name}),z(s.status)]}),e.jsxs("div",{className:t.sprintDates,children:[s.startDate," ~ ",s.endDate]}),e.jsx(u,{percent:s.totalPoints>0?Math.round(s.completedPoints/s.totalPoints*100):0,size:"small",format:()=>`${s.completedPoints}/${s.totalPoints} 点`})]},s.id)),x.filter(s=>s.status==="active").length===0&&e.jsx("div",{style:{textAlign:"center",padding:"24px",color:"#999"},children:"暂无进行中的迭代"})]}),e.jsxs("div",{className:t.card,children:[e.jsxs("div",{className:t.cardHeader,children:[e.jsx("h3",{className:t.cardTitle,children:"最近事项"}),e.jsx(r,{type:"primary",size:"small",icon:e.jsx(v,{}),onClick:()=>i("/issues"),children:"新建事项"})]}),o.slice(0,5).map(s=>e.jsxs("div",{className:t.issueItem,children:[g(s.type),e.jsx("span",{className:t.issueKey,children:s.key}),e.jsx("span",{className:t.issueTitle,children:s.title}),I(s.priority)]},s.id))]})]}),e.jsxs("div",{className:t.sideContent,children:[e.jsxs("div",{className:t.card,children:[e.jsxs("div",{className:t.cardHeader,children:[e.jsx("h3",{className:t.cardTitle,children:"团队成员"}),e.jsx(r,{type:"link",size:"small",onClick:()=>i("/members"),children:"管理"})]}),D.map(s=>e.jsxs("div",{className:t.memberItem,children:[e.jsx(f,{src:s.avatar,children:s.name.charAt(0)}),e.jsxs("div",{className:t.memberInfo,children:[e.jsx("div",{className:t.memberName,children:s.name}),e.jsx("div",{className:t.memberRole,children:s.role})]})]},s.id))]}),e.jsxs("div",{className:t.card,children:[e.jsx("div",{className:t.cardHeader,children:e.jsx("h3",{className:t.cardTitle,children:"最近活动"})}),L.map(s=>e.jsxs("div",{className:t.activityItem,children:[e.jsx(f,{size:"small",src:s.user?.avatar,children:s.user?.name.charAt(0)}),e.jsxs("div",{className:t.activityContent,children:[e.jsxs("div",{className:t.activityText,children:[e.jsx("strong",{children:s.user?.name})," ",s.action," ",s.target]}),e.jsx("div",{className:t.activityTime,children:s.time})]})]},s.id))]})]})]})},{key:"issues",label:"事项",children:e.jsxs("div",{style:{padding:"16px"},children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between"},children:[e.jsx(_,{children:e.jsx(r,{type:"primary",icon:e.jsx(v,{}),onClick:()=>i("/issues"),children:"新建事项"})}),e.jsx(r,{onClick:()=>i("/kanban"),children:"看板视图"})]}),e.jsx(Z,{columns:A,dataSource:o,rowKey:"id",pagination:{total:o.length,pageSize:10,showSizeChanger:!0,showTotal:s=>`共 ${s} 条`}})]})},{key:"iterations",label:"迭代",children:e.jsxs("div",{style:{padding:"16px"},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(r,{type:"primary",icon:e.jsx(v,{}),onClick:()=>i("/iterations"),children:"新建迭代"})}),x.map(s=>e.jsxs("div",{className:t.sprintCard,style:{marginBottom:16},children:[e.jsxs("div",{className:t.sprintHeader,children:[e.jsx("span",{className:t.sprintName,children:s.name}),z(s.status)]}),e.jsxs("div",{className:t.sprintDates,children:[s.startDate," ~ ",s.endDate]}),e.jsx(u,{percent:s.totalPoints>0?Math.round(s.completedPoints/s.totalPoints*100):0,size:"small",format:()=>`${s.completedPoints}/${s.totalPoints} 故事点`})]},s.id))]})},{key:"wiki",label:"文档",children:e.jsx("div",{style:{padding:"16px",textAlign:"center"},children:e.jsx(r,{type:"primary",onClick:()=>i("/wiki"),children:"进入知识库"})})}]})]}):e.jsx("div",{className:t.container,children:e.jsxs("div",{style:{textAlign:"center",padding:"48px"},children:[e.jsx("h2",{children:"项目不存在"}),e.jsx(r,{type:"primary",onClick:()=>i("/projects"),children:"返回项目列表"})]})})};export{Ls as default};
