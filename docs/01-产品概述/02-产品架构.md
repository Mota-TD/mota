# 摩塔 Mota - 产品架构

## 1. 整体架构图

```mermaid
graph TB
    subgraph 用户层
        A1[决策层用户]
        A2[管理层用户]
        A3[执行层用户]
    end

    subgraph 接入层
        B1[Web端]
        B2[移动端]
        B3[API接口]
    end

    subgraph 应用服务层
        C1[项目管理服务]
        C2[团队协作服务]
        C3[AI智能服务]
        C4[知识管理服务]
        C5[用户服务]
        C6[通知服务]
    end

    subgraph AI引擎层
        D1[大语言模型LLM]
        D2[知识图谱引擎]
        D3[RAG检索增强]
        D4[向量数据库]
        D5[模型路由器]
        D6[新闻采集服务]
    end

    subgraph 基础服务层
        E1[用户认证]
        E2[权限管理]
        E3[消息队列]
        E4[文件存储]
        E5[日志服务]
        E6[监控服务]
    end

    subgraph 基础设施层
        F1[容器编排]
        F2[数据库集群]
        F3[缓存集群]
        F4[搜索引擎]
        F5[对象存储]
        F6[GPU集群]
    end

    A1 & A2 & A3 --> B1 & B2 & B3
    B1 & B2 & B3 --> C1 & C2 & C3 & C4 & C5 & C6
    C1 & C2 & C3 & C4 & C5 & C6 --> D1 & D2 & D3 & D4 & D5 & D6
    D1 & D2 & D3 & D4 & D5 & D6 --> E1 & E2 & E3 & E4 & E5 & E6
    E1 & E2 & E3 & E4 & E5 & E6 --> F1 & F2 & F3 & F4 & F5 & F6
```

## 2. 功能模块架构

### 2.1 核心功能模块

```mermaid
graph LR
    subgraph 摩塔Mota平台
        subgraph 项目管理
            PM[项目看板]
            TM[任务管理]
            PT[进度跟踪]
        end

        subgraph 团队协作
            DC[文档协作]
            SC[日程管理]
            NC[通知中心]
        end

        subgraph AI智能
            KB[AI知识库]
            NEWS[智能新闻]
            AG[AI方案生成]
        end

        subgraph 知识管理
            DM[文档管理]
            KG[知识图谱]
            VS[版本控制]
        end
    end

    PM --> TM
    TM --> PT
    DC --> NC
    KB --> AG
    NEWS --> AG
    DM --> KG
```

### 2.2 模块依赖关系

| 模块 | 依赖模块 | 说明 |
|-----|---------|------|
| 项目管理 | 用户服务、通知服务 | 项目和任务的核心管理 |
| 团队协作 | 项目管理、通知服务 | 文档协作和日程管理 |
| AI智能 | 知识管理、AI引擎 | 基于知识库的智能服务 |
| 知识管理 | 文件存储、搜索引擎 | 文档和知识的管理 |
| AI方案生成 | AI知识库、智能新闻 | 结合知识和热点生成方案 |

## 3. AI技术架构

### 3.1 AI引擎架构

```mermaid
graph TB
    subgraph AI引擎
        LLM[大语言模型]
        
        subgraph 知识增强
            KB[企业知识库]
            VDB[向量数据库]
            RAG[RAG检索]
        end

        subgraph 模型管理
            MR[模型路由器]
            FB[降级策略]
            COST[成本控制]
        end

        subgraph 应用场景
            SEARCH[智能搜索]
            GEN[方案生成]
            ASSIST[AI助手]
        end
    end

    KB --> VDB --> RAG
    RAG --> LLM
    MR --> LLM
    FB --> MR
    COST --> MR
    LLM --> SEARCH & GEN & ASSIST
```

**AI技术栈**:
- 大语言模型: GPT-4 / Claude / 通义千问 / 文心一言
- 向量数据库: Milvus / Pinecone / Weaviate
- 知识图谱: Neo4j / JanusGraph
- AI框架: LangChain / LlamaIndex
- Embedding: OpenAI Embeddings / HuggingFace

### 3.2 RAG检索增强架构

```mermaid
graph LR
    subgraph 文档处理
        DOC[企业文档]
        PARSE[文档解析]
        CHUNK[文本分块]
        EMBED[向量嵌入]
    end

    subgraph 检索系统
        VDB[向量数据库]
        SEARCH[相似度检索]
        RERANK[重排序]
    end

    subgraph 生成系统
        CONTEXT[上下文构建]
        LLM[大语言模型]
        OUTPUT[输出生成]
    end

    DOC --> PARSE --> CHUNK --> EMBED --> VDB
    VDB --> SEARCH --> RERANK --> CONTEXT --> LLM --> OUTPUT
```

### 3.3 多模型管理架构

```mermaid
graph TB
    subgraph 应用层
        A1[知识库] --> B1[AI服务]
        A2[新闻推送] --> B1
        A3[方案生成] --> B1
        A4[智能搜索] --> B1
    end
    
    subgraph AI服务层
        B1 --> C1[模型路由器]
        C1 --> C2{模型选择策略}
    end
    
    subgraph 模型层
        C2 -->|成本优先| D1[GPT-3.5-turbo]
        C2 -->|质量优先| D2[GPT-4]
        C2 -->|合规优先| D3[通义千问]
        C2 -->|特定场景| D4[Claude]
        C2 -->|备用| D5[文心一言]
    end
    
    subgraph 管理层
        E1[Prompt模板管理]
        E2[模型性能监控]
        E3[成本控制]
        E4[A/B测试]
    end
    
    B1 --> E1
    D1 & D2 & D3 & D4 & D5 --> E2
    E2 --> E3
    E2 --> E4
```

## 4. 前端技术架构

```mermaid
graph TB
    subgraph 前端应用
        APP[Web应用]
        
        subgraph 核心模块
            PROJECT[项目管理]
            COLLAB[团队协作]
            AI[AI功能]
            KNOWLEDGE[知识管理]
        end

        subgraph 组件库
            UI[UI组件]
            CHART[图表组件]
            RICH[富文本编辑]
        end
    end

    APP --> PROJECT & COLLAB & AI & KNOWLEDGE
    PROJECT & COLLAB & AI & KNOWLEDGE --> UI & CHART & RICH
```

**技术栈**:
- 框架: React 18 + TypeScript
- 状态管理: Redux Toolkit + RTK Query
- UI组件库: Ant Design
- 图表库: ECharts / Recharts
- 富文本: TipTap / Slate
- 构建工具: Vite

## 5. 后端技术架构

```mermaid
graph TB
    subgraph API网关层
        GW[API Gateway]
        LB[负载均衡]
        AUTH[认证授权]
    end

    subgraph 业务服务层
        SVC1[用户服务]
        SVC2[项目服务]
        SVC3[协作服务]
        SVC4[知识库服务]
        SVC5[新闻服务]
        SVC6[AI服务]
    end

    subgraph 中间件层
        MQ[消息队列]
        CACHE[缓存服务]
        SEARCH[搜索服务]
    end

    subgraph 数据层
        DB1[关系数据库]
        DB2[向量数据库]
        DB3[文档数据库]
        OSS[对象存储]
    end

    GW --> LB --> AUTH
    AUTH --> SVC1 & SVC2 & SVC3 & SVC4 & SVC5 & SVC6
    SVC2 & SVC3 & SVC4 & SVC5 & SVC6 --> MQ & CACHE & SEARCH
    MQ & CACHE & SEARCH --> DB1 & DB2 & DB3 & OSS
```

**技术栈**:
- 语言: Python / Java / Go / Node.js
- 框架: FastAPI / Spring Cloud / Gin / NestJS
- 数据库: PostgreSQL / MongoDB
- 向量库: Milvus / Pinecone
- 缓存: Redis
- 消息队列: Kafka / RabbitMQ
- 搜索: Elasticsearch
- 容器: Docker / Kubernetes

### 5.1 微服务拆分

| 服务名称 | 职责 | 技术栈 |
|---------|------|--------|
| user-service | 用户认证、授权、管理 | Spring Boot, JWT |
| project-service | 项目、任务、看板管理 | Spring Boot, PostgreSQL |
| collaboration-service | 文档协作、日程管理 | Node.js, WebSocket |
| ai-service | AI模型调用、Prompt管理 | Python, FastAPI |
| knowledge-service | 知识库、文档管理 | Spring Boot, Elasticsearch |
| news-service | 新闻采集、推送 | Python, Celery |
| notification-service | 统一通知服务 | Node.js, RabbitMQ |
| file-service | 文件上传、存储、预览 | Spring Boot, MinIO |
| search-service | 全局搜索服务 | Python, Elasticsearch |
| analytics-service | 数据分析、报表 | Python, Pandas |

## 6. 数据架构

### 6.1 数据流架构

```mermaid
graph LR
    subgraph 数据采集
        DOC[企业文档]
        NEWS[新闻数据]
        LOG[用户行为]
    end

    subgraph 数据处理
        ETL[数据清洗]
        EMBED[向量化]
        INDEX[索引构建]
    end

    subgraph 数据存储
        VDB[向量数据库]
        RDB[关系数据库]
        DW[数据仓库]
    end

    subgraph 数据应用
        RAG[RAG检索]
        ANAL[数据分析]
        REPORT[报表生成]
    end

    DOC & NEWS & LOG --> ETL
    ETL --> EMBED --> VDB
    ETL --> INDEX --> RDB
    ETL --> DW
    VDB --> RAG
    DW --> ANAL --> REPORT
```

### 6.2 核心数据模型

```mermaid
erDiagram
    USER ||--o{ PROJECT : creates
    USER ||--o{ TASK : assigned
    USER ||--o{ DOCUMENT : uploads
    USER }o--o{ ORGANIZATION : belongs_to
    
    ORGANIZATION ||--o{ DEPARTMENT : contains
    ORGANIZATION ||--o{ PROJECT : owns
    ORGANIZATION ||--o{ KNOWLEDGE_BASE : has
    
    PROJECT ||--o{ TASK : contains
    PROJECT ||--o{ DOCUMENT : has
    
    TASK ||--o{ COMMENT : has
    TASK ||--o{ ATTACHMENT : has
    TASK }o--|| TASK : depends_on
    
    KNOWLEDGE_BASE ||--o{ DOCUMENT : stores
    DOCUMENT ||--o{ DOCUMENT_CHUNK : splits_to
    DOCUMENT_CHUNK ||--|| EMBEDDING : has
    
    AI_SOLUTION ||--|| USER : generated_by
    AI_SOLUTION ||--o{ KNOWLEDGE_BASE : references
```

## 7. 部署架构

### 7.1 SaaS 部署架构

```mermaid
graph TB
    subgraph 用户
        USER[用户访问]
    end

    subgraph CDN
        CDN1[静态资源CDN]
    end

    subgraph 云平台
        subgraph 接入层
            WAF[Web应用防火墙]
            LB[负载均衡]
        end

        subgraph 应用层
            K8S[Kubernetes集群]
        end

        subgraph AI层
            GPU[GPU集群]
            LLM[LLM服务]
        end

        subgraph 数据层
            RDS[云数据库]
            VDB[向量数据库]
            OSS[对象存储]
        end
    end

    USER --> CDN1
    USER --> WAF --> LB --> K8S
    K8S --> GPU --> LLM
    K8S --> RDS & VDB & OSS
```

### 7.2 私有部署架构

```mermaid
graph TB
    subgraph 企业内网
        subgraph DMZ区
            LB[负载均衡]
            WAF[防火墙]
        end

        subgraph 应用区
            APP1[应用服务器1]
            APP2[应用服务器2]
            APP3[应用服务器N]
        end

        subgraph AI计算区
            GPU1[GPU服务器1]
            GPU2[GPU服务器2]
            LLM[本地LLM]
        end

        subgraph 数据区
            DB1[主数据库]
            DB2[从数据库]
            VDB[向量数据库]
            STORAGE[存储集群]
        end
    end

    LB --> WAF
    WAF --> APP1 & APP2 & APP3
    APP1 & APP2 & APP3 --> GPU1 & GPU2 --> LLM
    APP1 & APP2 & APP3 --> DB1 & VDB & STORAGE
    DB1 --> DB2
```

## 8. 安全架构

### 8.1 安全分层

| 层级 | 安全措施 |
|-----|---------|
| 网络层 | DDoS防护、WAF、VPN |
| 传输层 | HTTPS/TLS加密 |
| 应用层 | 身份认证、访问控制、API安全 |
| AI层 | 模型隔离、数据脱敏、输出过滤 |
| 数据层 | 数据加密、备份、多租户隔离 |

### 8.2 认证授权

```mermaid
graph LR
    subgraph 认证方式
        A1[账号密码]
        A2[SSO单点登录]
        A3[OAuth2.0]
        A4[企业微信/钉钉]
    end

    subgraph 授权模型
        B1[RBAC角色权限]
        B2[企业权限]
        B3[项目权限]
        B4[API权限]
    end

    A1 & A2 & A3 & A4 --> AUTH[认证中心]
    AUTH --> B1 --> B2 --> B3 --> B4
```

## 9. 扩展架构

### 9.1 API开放平台

```mermaid
graph TB
    subgraph OpenAPI
        API1[项目管理API]
        API2[任务管理API]
        API3[知识库API]
        API4[AI服务API]
    end

    subgraph 集成能力
        I1[企业微信]
        I2[钉钉]
        I3[飞书]
        I4[Webhook]
    end

    API1 & API2 & API3 & API4 --> GW[API网关]
    GW --> I1 & I2 & I3 & I4
```

### 9.2 插件系统

- 自定义工作流插件
- 第三方LLM接入
- 数据源连接器
- 报表模板扩展

---

*摩塔 Mota - AI驱动的项目管理与团队协作平台*