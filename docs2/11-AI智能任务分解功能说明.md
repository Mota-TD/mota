# AI 智能任务分解功能说明

## 功能概述

AI 智能任务分解功能使用 Claude 大模型，根据项目描述自动生成任务分解建议。该功能可以帮助项目经理快速将项目拆分为可执行的具体任务。

## 技术实现

### 后端架构

```
AIController
    └── ClaudeService
            └── Claude API (Anthropic)
```

### 核心文件

1. **配置类**: `ClaudeConfig.java`
   - 路径: `mota-service/mota-project-service/src/main/java/com/mota/project/config/ClaudeConfig.java`
   - 功能: 管理 Claude API 的配置参数

2. **服务类**: `ClaudeService.java`
   - 路径: `mota-service/mota-project-service/src/main/java/com/mota/project/service/ai/ClaudeService.java`
   - 功能: 调用 Claude API 进行任务分解

3. **控制器**: `AIController.java`
   - 路径: `mota-service/mota-project-service/src/main/java/com/mota/project/controller/AIController.java`
   - 接口: `POST /api/v1/ai/project/decompose`

## 配置说明

### 环境变量配置

在 `application.yml` 中添加以下配置：

```yaml
ai:
  claude:
    # Claude API Key - 必须配置
    api-key: ${CLAUDE_API_KEY:}
    # Claude API Base URL
    base-url: ${CLAUDE_BASE_URL:https://api.anthropic.com/v1}
    # 默认模型
    model: ${CLAUDE_MODEL:claude-3-sonnet-20240229}
    # 最大 token 数
    max-tokens: ${CLAUDE_MAX_TOKENS:4096}
    # 温度参数 (0-1)
    temperature: ${CLAUDE_TEMPERATURE:0.7}
    # 请求超时时间（秒）
    timeout: ${CLAUDE_TIMEOUT:120}
```

### 获取 Claude API Key

1. 访问 [Anthropic Console](https://console.anthropic.com/)
2. 注册/登录账号
3. 在 API Keys 页面创建新的 API Key
4. 将 API Key 设置为环境变量 `CLAUDE_API_KEY`

### 可用模型

| 模型名称 | 说明 | 适用场景 |
|---------|------|---------|
| claude-3-opus-20240229 | 最强大的模型 | 复杂任务分析 |
| claude-3-sonnet-20240229 | 平衡性能和成本 | 推荐使用 |
| claude-3-haiku-20240307 | 最快速的模型 | 简单任务 |

## API 接口

### 任务分解接口

**请求**

```http
POST /api/v1/ai/project/decompose
Content-Type: application/json

{
  "projectName": "项目名称",
  "projectDescription": "项目描述，越详细越好",
  "departments": ["技术部", "产品部", "测试部"],
  "startDate": "2024-01-01",
  "endDate": "2024-03-31"
}
```

**响应**

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "suggestions": [
      {
        "id": "1",
        "name": "需求分析与规划",
        "description": "收集和分析项目需求，制定详细的项目计划",
        "suggestedDepartment": "产品部",
        "suggestedPriority": "high",
        "estimatedDays": 5,
        "dependencies": []
      },
      {
        "id": "2",
        "name": "技术方案设计",
        "description": "根据需求设计技术架构和实现方案",
        "suggestedDepartment": "技术部",
        "suggestedPriority": "high",
        "estimatedDays": 3,
        "dependencies": ["1"]
      }
    ],
    "totalEstimatedDays": 28,
    "riskAssessment": "项目风险评估说明..."
  }
}
```

## 前端集成

### 调用示例

```typescript
import { aiApi } from '@/services/api/ai'

// 调用 AI 任务分解
const response = await aiApi.generateTaskDecomposition({
  projectName: '电商平台开发',
  projectDescription: '开发一个B2C电商平台，包含商品管理、订单管理、支付等功能',
  departments: ['技术部', '产品部', '测试部'],
  startDate: '2024-01-01',
  endDate: '2024-06-30'
})

// 处理返回的任务建议
const { suggestions, totalEstimatedDays, riskAssessment } = response
```

## 降级策略

当 Claude API 不可用时（API Key 未配置或调用失败），系统会自动返回模拟数据，确保功能可用性。模拟数据包含标准的项目任务模板：

1. 需求分析与规划
2. 技术方案设计
3. UI/UX设计
4. 核心功能开发
5. 单元测试
6. 集成测试
7. 用户验收测试
8. 部署上线

## 注意事项

1. **API 费用**: Claude API 按 token 计费，请注意控制使用量
2. **网络要求**: 需要能够访问 `api.anthropic.com`
3. **超时设置**: 默认 120 秒，复杂项目可能需要更长时间
4. **数据安全**: 项目信息会发送到 Anthropic 服务器，请注意敏感信息

## 后续优化

1. 支持流式响应，提升用户体验
2. 添加任务分解历史记录
3. 支持自定义提示词模板
4. 集成更多 AI 模型（如 GPT-4、文心一言等）